# File managed by puppet in module bullxbm-slurm

include /etc/slurm/slurm-server.conf

################################################
#                   CONTROL                    #
################################################
ClusterName=this_is_a_fake_taranis
ControlMachine=slurm_controller_daemon
SlurmUser=slurm
SlurmctldPort=6817
SlurmdPort=6818
SlurmdUser=root
#
################################################
#            LOGGING & OTHER PATHS             #
################################################
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdLogFile=/var/log/slurm/slurm.%h.log
SlurmdPidFile=/var/run/slurmd.pid
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmdSpoolDir=/var/spool/slurmd
StateSaveLocation=/opt/SLURM
DebugFlags=NO_CONF_HASH,Elasticsearch
#DebugFlags=NO_CONF_HASH,Elasticsearch,Profile
#
################################################
#                  ACCOUNTING                  #
################################################
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost=slurm_db_daemon
AccountingStoragePort=6819
AccountingStorageEnforce=limits,qos,associations
AcctGatherNodeFreq=20
JobAcctGatherFrequency=10,energy=1
JobAcctGatherType=jobacct_gather/linux
#
################################################
#           SCHEDULING & ALLOCATION            #
################################################
#FastSchedule=1
PreemptMode=CANCEL
PreemptType=preempt/qos
SchedulerType=sched/backfill
SchedulerParameters=default_queue_depth=400,bf_max_job_test=5000,bf_max_job_user=200,bf_interval=30,bf_continue,max_rpc_cnt=64,max_switch_wait=31536000
SelectType=select/cons_tres
SelectTypeParameters=CR_Core_Memory,CR_CORE_DEFAULT_DIST_BLOCK
#SlurmSchedLogLevel=0
PriorityType=priority/multifactor
PriorityDecayHalfLife=4-00:00:00
PriorityCalcPeriod=00:05:00
PriorityFavorSmall=YES
PriorityMaxAge=08:00:00
PriorityUsageResetPeriod=NONE
PriorityWeightAge=90000
PriorityWeightFairShare=400000
PriorityWeightJobSize=1
PriorityWeightPartition=30000
PriorityWeightQOS=1000000
#
################################################
#                   TOPOLOGY                   #
################################################
TopologyPlugin=topology/tree
RoutePlugin=route/topology
#
################################################
#                    TIMERS                    #
################################################
BatchStartTimeout=20
#CompleteWait=0
##EpilogMsgTime=2000
##GetEnvTimeout=2
InactiveLimit=1200
KillWait=360
UnkillableStepTimeout=180
MinJobAge=300
SlurmctldTimeout=300
SlurmdTimeout=300
WaitTime=0
MessageTimeout=40
#
################################################
#                    DEBUG                     #
################################################
#DebugFlags=NO_CONF_HASH
SlurmctldDebug=debug
SlurmdDebug=verbose
#SlurmdDebug=debug3
#
################################################
#               EPILOG & PROLOG                #
################################################
Epilog=/etc/slurm/scripts/epilog.sh            
Prolog=/etc/slurm/scripts/prolog.sh            
TaskProlog=/etc/slurm/scripts/taskProlog.pl    
#SrunProlog=/etc/slurm/scripts/srun_prolog.sh
#SrunEpilog=                                   
##SrunProlog=                                   
##TaskEpilog=/etc/slurm/taskepilog.sh           
##EpilogSlurmctld=/etc/slurm/epilog_slurmctld.sh
##PrologSlurmctld=/etc/slurm/prolog_slurmctld.sh
##PrologFlags=                                  
PrologFlags=contain                            
#
################################################
#               PROCESS TRACKING               #
################################################
ProctrackType=proctrack/cgroup
#
################################################
#             RESOURCE CONFINEMENT             #
################################################
TaskPlugin=task/affinity,task/cgroup
#TaskPluginParam=
#
################################################
#                    OTHER                     #
################################################
ResvOverRun=120                       
#AllowSpecResourcesUsage=0            
#AuthInfo=                            
AuthType=auth/munge
CredType=cred/munge               
#EnforcePartLimits=YES                
#FairShareDampeningFactor=5           
#FirstJobId=1                         
#GresTypes=                           
#GroupUpdateForce=0                   
#GroupUpdateTime=600                  
HealthCheckInterval=600               
HealthCheckNodeState=ANY
#HealthCheckProgram=/usr/sbin/nhc      
JobRequeue=1                          
#JobSubmitPlugins=switches                  
#KillOnBadExit=0                      
#Layouts=                             
MailProg= /bin/true                           
MpiDefault=pmi2                       
MpiParams=ports=13000-18000           
ReturnToService=0                     
##SallocDefaultCommand=                
SwitchType=switch/none                
##TrackWCKey=0                         
##TreeWidth=50                         
UsePam=0                              
#JobCompType=jobcomp/elasticsearch     
#JobCompLoc=http://taranismetrics0:9200/slurm/_doc
################################################
#                    NODES                     #
################################################
include /etc/slurm/partition.conf
